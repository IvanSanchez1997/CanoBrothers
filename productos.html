<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Granizados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
             font-family: "SEGOE UI";
        }

        td {
            font-size: 14px;
        }

        body {
            background-color: #f3f3f3;
            padding-top: 20px;
        }

        .producto-card {
            border: none;
            border-radius: 0.5rem;
            /*box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.05);*/
            transition: transform 0.2s;
            margin-bottom: 1rem;
            background-color: white;
        }
        .producto-titulo {
            font-weight: 450;
            color: black;
            margin-bottom: 0.10rem;
            font-size: 16px;
        }
        .producto-descripcion {
            color: #6c757d;
            margin-bottom: 0.1rem;
            font-size: 16px;
        }
        .tabla-precios {
            width: 100%;
        }
        .tabla-precios td {
            padding: 0.3rem 0;
            border-bottom: 1px solid #f1f1f1;
        }
        /*.tabla-precios tr:last-child td {
            border-bottom: none;
        }*/
        .tabla-precios td:first-child {
            width: 60%;
        }
        .tabla-precios td:last-child {
            text-align: right;
            font-weight: 500;
            color: #0d6efd; /* AZUL para los precios */
        }
        .nota-producto {
            font-style: italic;
            color: #6c757d;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .badge-tamano {
            font-size: 0.75em;
            padding: 0.35em 0.65em;
        }
        /* IMAGEN MÁS PEQUEÑA Y A LA IZQUIERDA */
        .contenedor-imagen {
            width: 70px;
            height: 70px;
            border-radius: 0.3rem;
            overflow: hidden;
            flex-shrink: 0;
        }
        .producto-imagen {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .alergenos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.15rem 0;
        }
        .icono-alergeno {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            object-fit: cover;
        }
        /* Estructura flexible para alinear imagen a la izquierda */
        .producto-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.1rem;
        }
        .producto-info {
            flex: 1;
        }

        .row{
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Botón de volver arriba a la izquierda -->
        <div class="row">
            <div class="text-left bg-white px-3 py-2" style="position: fixed; top: 0; width: 100%; z-index: 1000;">
                <button class="text-decoration-none text-dark back" style="background-color: white; border: none;" onclick="window.history.back()">
                    <i class="fas fa-chevron-circle-left"></i> Volver
                </button>
            </div>
        </div>

        <!-- Header de categoría -->
        <div class="d-flex mt-4 mx-6"></div> 
        <div class="h2 fw-normal flex-fill" style="padding-bottom: 15px;">
            <h1 class="h3 mb-0" style="margin-top: 0.5rem; font-weight: normal; font-size: 22px;" id="nombre-categoria">Cargando...</h1>
        </div>

        <!-- Separador de Categoria y Productos a pelo -->
        <div style="position:relative; left:50%; transform:translateX(-50%); width:100vw; height:6px; background-color:#0d6efd; margin:0px 0;"></div>
        <div style="position:relative; left:50%; transform:translateX(-50%); width:100vw; height:12px; background-color:white; margin:0px 0;"></div>

        <!-- Contenedor de productos -->
        <div class="row" id="contenedor-productos">
            <!-- Los productos se insertarán aquí mediante JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Obtener datos del localStorage
            const categoria = localStorage.getItem('categoriaSeleccionada');
            const data = JSON.parse(localStorage.getItem('data'));
            
            // Elementos DOM
            const nombreCategoria = document.getElementById('nombre-categoria');
            const contenedorProductos = document.getElementById('contenedor-productos');
            
            // Verificar si tenemos datos
            if (categoria && data && data[categoria]) {
                // Mostrar el nombre de la categoría
                nombreCategoria.textContent = categoria;
                
                // Mostrar productos
                mostrarProductos(categoria, data);
            } else {
                // Mostrar mensaje de error si no hay datos
                contenedorProductos.innerHTML = `
                    <div class="alert alert-warning text-center">
                        No se encontraron productos para esta categoría.
                    </div>
                `;
            }
            
            function mostrarProductos(categoria, data) {
                contenedorProductos.innerHTML = '';
                
                data[categoria].forEach(producto => {
                    const col = document.createElement('div');
                    col.className = 'col-12 mb-3';
                    
                    // === IMAGEN DEL PRODUCTO ===
                    let productImage = "";
                    if (producto.img && producto.img.trim() !== "") {
                        productImage = `
                            <div class="contenedor-imagen">
                                <img src="${producto.img}" class="producto-imagen" alt="${producto.name}">
                            </div>
                        `;
                    }
                    
                    // === ICONOS DE ALÉRGENOS ===
                    let allergensIcons = "";
                    if (Array.isArray(producto.allergensImg) && producto.allergensImg.length > 0) {
                        allergensIcons = `
                            <div class="alergenos-container">
                                ${producto.allergensImg.map(icon => `
                                    <img src="${icon}" class="icono-alergeno" alt="Alergeno">
                                `).join("")}
                            </div>
                        `;
                    } else if (typeof producto.allergensImg === "string" && producto.allergensImg.trim() !== "") {
                        allergensIcons = `
                            <div class="alergenos-container">
                                <img src="${producto.allergensImg}" class="icono-alergeno" alt="Alergeno">
                            </div>
                        `;
                    }
                    
                    // === TABLA DE PRECIOS ===
                    let tablaPrecios = '';
                    if (producto.singlePrice || producto.price1 || producto.price2 || producto.price3) {
                        tablaPrecios = `
                            <table class="tabla-precios mt-2">
                                ${producto.singlePrice ? `<tr><td></td><td class="text-primary">${producto.singlePrice}</td></tr>` : ''}
                                ${producto.price1 ? `<tr><td>Pequeño</td><td class="text-primary">${producto.price1}</td></tr>` : ''}
                                ${producto.price2 ? `<tr><td>Mediano</td><td class="text-primary">${producto.price2}</td></tr>` : ''}
                                ${producto.price3 ? `<tr><td>Grande</td><td class="text-primary">${producto.price3}</td></tr>` : ''}
                            </table>
                        `;
                    }
                    
                    // === ALERTA ===
                    let alertaBadge = '';
                    if (producto.alert && producto.alert.trim() !== "") {
                        alertaBadge = `<span class="badge bg-info badge-tamano">${producto.alert}</span>`;
                    }
                    
                    col.innerHTML = `
                        <div class="producto-card">
                            <div class="card-body">
                                <div class="producto-header">
                                    ${productImage}
                                    <div class="producto-info">
                                        <h5 class="producto-titulo">${producto.name || 'Producto'}</h5>
                                        ${alertaBadge}
                                        <p class="producto-descripcion">${producto.description || ''}</p>
                                    </div>
                                </div>
                                ${allergensIcons}
                                ${tablaPrecios}
                            </div>
                        </div>
                    `;
                    
                    contenedorProductos.appendChild(col);
                });
            }
        });
    </script>
</body>
</html>
