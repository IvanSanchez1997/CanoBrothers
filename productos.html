<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Granizados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .categoria-header {
            background-color: #f1f3f5; /* Gris mucho más claro */
            color: #495057;
            padding: 1rem 0;
            margin-bottom: 1.5rem;
            /* Quitamos bordes redondeados */
        }
        .producto-card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            margin-bottom: 1rem;
            background-color: white;
        }
        .producto-titulo {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .producto-descripcion {
            color: #6c757d;
            margin-bottom: 0.75rem;
        }
        .tabla-precios {
            width: 100%;
        }
        .tabla-precios td {
            padding: 0.3rem 0;
            border-bottom: 1px solid #f1f1f1;
        }
        .tabla-precios tr:last-child td {
            border-bottom: none;
        }
        .tabla-precios td:first-child {
            width: 60%;
        }
        .tabla-precios td:last-child {
            text-align: right;
            font-weight: 500;
            color: #0d6efd; /* AZUL para los precios */
        }
        .nota-producto {
            font-style: italic;
            color: #6c757d;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        .btn-volver {
            margin-bottom: 1rem;
            border-radius: 0.3rem;
        }
        .badge-tamano {
            font-size: 0.75em;
            padding: 0.35em 0.65em;
        }
        /* IMAGEN MÁS PEQUEÑA Y A LA DERECHA */
        .contenedor-imagen {
            width: 80px;
            height: 80px;
            border-radius: 0.3rem;
            overflow: hidden;
            margin-left: auto;
        }
        .producto-imagen {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .alergenos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }
        .icono-alergeno {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
        }
        /* Estructura flexible para alinear imagen a la derecha */
        .producto-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        .producto-info {
            flex: 1;
            margin-right: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Botón de volver arriba a la izquierda -->
        <div class="row">
            <div class="col-12">
                <button class="btn btn-outline-secondary btn-volver" onclick="window.history.back()">
                    <i class="fas fa-arrow-left me-2"></i>Volver
                </button>
            </div>
        </div>

        <!-- Header de categoría -->
        <div class="categoria-header text-center">
            <h1 class="h3 mb-0" id="nombre-categoria">Cargando...</h1>
        </div>

        <!-- Contenedor de productos -->
        <div class="row" id="contenedor-productos">
            <!-- Los productos se insertarán aquí mediante JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Obtener datos del localStorage
            const categoria = localStorage.getItem('categoriaSeleccionada');
            const data = JSON.parse(localStorage.getItem('data'));
            
            // Elementos DOM
            const nombreCategoria = document.getElementById('nombre-categoria');
            const contenedorProductos = document.getElementById('contenedor-productos');
            
            // Verificar si tenemos datos
            if (categoria && data && data[categoria]) {
                // Mostrar el nombre de la categoría
                nombreCategoria.textContent = categoria;
                
                // Mostrar productos
                mostrarProductos(categoria, data);
            } else {
                // Mostrar mensaje de error si no hay datos
                contenedorProductos.innerHTML = `
                    <div class="alert alert-warning text-center">
                        No se encontraron productos para esta categoría.
                    </div>
                `;
            }
            
            function mostrarProductos(categoria, data) {
                contenedorProductos.innerHTML = '';
                
                data[categoria].forEach(producto => {
                    const col = document.createElement('div');
                    col.className = 'col-12 mb-3';
                    
                    // === IMAGEN DEL PRODUCTO (MÁS PEQUEÑA) ===
                    let productImage = "";
                    if (producto.img && producto.img.trim() !== "") {
                        productImage = `
                            <div class="contenedor-imagen">
                                <img src="${producto.img}" class="producto-imagen" alt="${producto.name}">
                            </div>
                        `;
                    }
                    
                    // === ICONOS DE ALÉRGENOS ===
                    let allergensIcons = "";
                    if (Array.isArray(producto.allergensImg) && producto.allergensImg.length > 0) {
                        allergensIcons = `
                            <div class="alergenos-container">
                                ${producto.allergensImg.map(icon => `
                                    <img src="${icon}" class="icono-alergeno" alt="Alergeno">
                                `).join("")}
                            </div>
                        `;
                    } else if (typeof producto.allergensImg === "string" && producto.allergensImg.trim() !== "") {
                        allergensIcons = `
                            <div class="alergenos-container">
                                <img src="${producto.allergensImg}" class="icono-alergeno" alt="Alergeno">
                            </div>
                        `;
                    }
                    
                    // === TABLA DE PRECIOS ===
                    let tablaPrecios = '';
                    if (producto.price1 || producto.price2 || producto.price3) {
                        tablaPrecios = `
                            <table class="tabla-precios mt-2">
                                ${producto.price1 ? `<tr><td>Pequeño</td><td class="text-primary">${producto.price1}</td></tr>` : ''}
                                ${producto.price2 ? `<tr><td>Mediano</td><td class="text-primary">${producto.price2}</td></tr>` : ''}
                                ${producto.price3 ? `<tr><td>Grande</td><td class="text-primary">${producto.price3}</td></tr>` : ''}
                            </table>
                        `;
                    }
                    
                    // === ALERTA ===
                    let alertaBadge = '';
                    if (producto.alert && producto.alert.trim() !== "") {
                        alertaBadge = `<span class="badge bg-info badge-tamano">${producto.alert}</span>`;
                    }
                    
                    col.innerHTML = `
                        <div class="producto-card">
                            <div class="card-body">
                                <div class="producto-header">
                                    <div class="producto-info">
                                        <h5 class="producto-titulo">${producto.name || 'Producto'}</h5>
                                        <p class="producto-descripcion mb-1">${producto.description || ''}</p>
                                        ${alertaBadge}
                                    </div>
                                    ${productImage}
                                </div>
                                ${allergensIcons}
                                ${tablaPrecios}
                                ${producto.allergensDes ? `<p class="nota-producto mt-2">${producto.allergensDes}</p>` : ''}
                            </div>
                        </div>
                    `;
                    
                    contenedorProductos.appendChild(col);
                });
            }
        });
    </script>
</body>
</html>